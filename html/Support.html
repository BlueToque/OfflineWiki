<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<title>TrueNorth Support</title>
	<meta name="description" content="Mapping Software for Backcountry Professionals"/>
	<meta name="author" content="TrueNorth Geospatial"/>
	<meta name="viewport" content="width=device-width"/>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
	<style type="text/css">
	    body {
	      padding-top: 60px;
	      padding-bottom: 40px;
	    }
	</style>
    <link rel="shortcut icon" href="favicon.ico" />	
	<link rel="stylesheet" type="text/css" href="css/style.css" />
 </head>
<body>
    <!--menu-->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">TrueNorth Geospatial</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="Agreement.html">Agreement</a></li>
                    <li ><a href="Licences.html">Licences</a></li>
                    <li class="active"><a href="Support.html">Support</a></li>
                </ul>
            </div><!--/.navbar-collapse -->
        </div>
    </div>
    <!--/menu-->

    <div id="html" class="container">

    </div>

    <div id="md" class="container">

      <div class="row">

        <div class="col-md-3">
          <div id="markdown-index"></div>
        </div>

        <div class="col-md-9">
          <div id="markdown"></div>
        </div>

      </div>     

    </div> <!-- /container -->


    <footer>
        <p>&copy; <a href="http://www.BlueToque.ca">BlueToque Software</a> <script type="text/javascript"> document.write(new Date().getFullYear())</script></p>
    </footer>
    <script src="js/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/Markdown.Converter.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            loadMarkDown("index.md", '#markdown-index');
            if (QueryString.hasOwnProperty("md")) {
                loadFromQueryString(QueryString);
            }
            else {
                loadMarkDown("home.md", '#markdown')
            }
            //loadMarkDown("home.md", '#markdown');
        });

        function loadFromQueryString(queryString) {
            loadMarkDown(queryString.md, '#markdown');
        }

        // http://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-url-parameter
        // This function is anonymous, is executed immediately and 
        // the return value is assigned to QueryString!
        var QueryString = function () {
            var query_string = {};
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                // If first entry with this name
                if (typeof query_string[pair[0]] === "undefined") {
                    query_string[pair[0]] = pair[1];
                    // If second entry with this name
                } else if (typeof query_string[pair[0]] === "string") {
                    var arr = [query_string[pair[0]], pair[1]];
                    query_string[pair[0]] = arr;
                    // If third or later entry with this name
                } else {
                    query_string[pair[0]].push(pair[1]);
                }
            }
            return query_string;
        }();

        function getUrl() {
            var url = window.location.href
            var arr = url.split("/");
            var result = arr[0] + "//" + arr[2]
            return result;
        }

        // get the named file, convert it to HTML
        // then display it in the given div
        function loadMarkDown(file, dest) {
            try {
                if (window.external && 'GetFile' in window.external) {
                    data = window.external.GetFile(file);
                    var converter = new Markdown.Converter();
                    $(dest).html(converter.makeHtml(data));
                }
                else {
                    $.get(file, function (data) {
                        var converter = new Markdown.Converter();
                        $(dest).html(converter.makeHtml(data));
                    }).fail(function () {
                        $(dest).html("<h1> '" + file + "' Not found</h1>");
                    });
                }
            }
            catch (ex) {
                $(destination).html("<h1>Error: '" + ex + "' /h1>");
            }
        }

        /// When an link is clicked, check that the link ends in "*.md"
        /// If it does, set the URL with a parameter for that file (the load event will load the value)
        /// Otherwise use normal navigation to load the page
        $(document).on("click", 'a', function (event) {

            if (/.md$/.test(event.currentTarget.href)) {

                var thisUrl = getUrl();
                var target = event.currentTarget.href.replace(thisUrl, "");
                // remove the leading "/"
                target = target.substring(1);
                window.location.href = getUrl() + "?md=" + target;
                return false;
            }
            if (/.htm$/.test(event.currentTarget.href)) {
                var thisUrl = getUrl();
                var target = event.currentTarget.href.replace(thisUrl, "");
                // remove the leading "/"
                target = target.substring(1);
                window.location.href = getUrl() + "?md=" + target;
                return false;
            }
            return true;
        });
    </script>

</body>
</html>
